<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>C√≥mo crear un gr√°fico simple a partir de la API de Eustat, JavaScript y Highcharts</title>

  <!-- Estilo tipo Markdown / GitHub -->
  <style>
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #fafafa;
      color: #333;
      max-width: 800px;
      margin: 2em auto;
      padding: 0 1em;
      line-height: 1.7;
    }
    h1, h2 {
      color: #1a1a1a;
      margin-top: 2em;
    }
    a {
      color: #0366d6;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    code, pre {
      font-family: Consolas, Monaco, monospace;
      font-size: 0.95em;
    }
    pre {
      background-color: #f6f8fa;
      border: 1px solid #d1d5da;
      border-radius: 6px;
      padding: 1em;
      overflow-x: auto;
    }
    .nota {
      margin-top: 2em;
      font-size: 0.95em;
      color: #555;
      font-style: italic;
    }
    #container {
      margin-top: 2em;
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 1em;
      border-radius: 8px;
    }
  </style>

  <!-- Librer√≠as -->
  <script src="https://cdn.jsdelivr.net/npm/jsonstat@0.13.3/json-stat.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>

  <h1>C√≥mo crear un gr√°fico simple a partir de la API de Eustat, <em>JavaScript</em> y Highcharts</h1>

  <p>
    Este corto tutorial muestra c√≥mo crear una visualizaci√≥n din√°mica con Highcharts a partir de una consulta a la API de Eustat.
    Se presenta un ejemplo b√°sico con el objetivo de incentivar el uso de la API en la visualizaci√≥n de estad√≠sticas.
  </p>

  <h2>1. Estructura b√°sica del HTML</h2>
  <p>
    Highcharts es una biblioteca <em>JavaScript</em> de gr√°ficos interactivos que permite generar visualizaciones atractivas con poco esfuerzo: l√≠neas, barras, mapas, √°reas, etc.
    Para ver gr√°ficos m√°s elaborados y su c√≥digo, puedes visitar la <a href="https://www.highcharts.com/demo" target="_blank">galer√≠a de ejemplos de Highcharts</a>.
  </p>
  <p>
    Una de las ventajas de Highcharts es que se integra f√°cilmente con APIs y necesita poco HTML. Para este gr√°fico de l√≠neas solo necesitaremos una p√°gina con una
    referencia a las librer√≠as necesarias y un contenedor para el gr√°fico.
  </p>

  <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;title&gt;Chart&lt;/title&gt;
  &lt;script src="http://code.jquery.com/jquery-1.9.1.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="container" style="height: 400px;"&gt;&lt;/div&gt;
  &lt;script src="http://code.highcharts.com/highcharts.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript"&gt;
    // Aqu√≠ se inserta el c√≥digo para obtener datos de la API y dibujar el gr√°fico
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

  <h2>2. Consulta a la API de Eustat</h2>
  <p>
    La siguiente consulta <em>JSON</em> se ha generado utilizando la interfaz de selecci√≥n de variables y valores de una tabla del Banco de Datos de Eustat:
    <a href="https://www.eustat.eus/bankupx/pxweb/es/DB/-/PX_010154_cepv1_ep06b.px" target="_blank">https://www.eustat.eus/bankupx/pxweb/es/DB/-/PX_010154_cepv1_ep06b.px</a>.
  </p>
  <p>
    El asistente para la selecci√≥n de valores permite seleccionar los datos que nos interesan f√°cilmente y obtener la consulta en formato <em>JSON</em>. Seleccionamos
    la poblaci√≥n total de la C.A. de Euskadi, Araba/√Ålava, Bizkaia y Gipuzkoa, a 1 de enero para los a√±os 2001‚Äì2024. Esta consulta puede integrarse directamente
    dentro del bloque <code>&lt;script&gt;</code> del HTML. El <em>endpoint</em> espera una solicitud <em>POST</em> con este contenido.
  </p>

  <pre><code>{
  const url = "https://www.eustat.eus/bankupx/api/v1/es/DB/PX_010154_cepv1_ep06b.px";
  const query = {
    "query": [
      {
        "code": "√°mbitos territoriales",
        "selection": {
          "filter": "item",
          "values": ["00001", "01", "48", "20"]
        }
      },
      {
        "code": "grandes grupos de edad cumplida",
        "selection": {
          "filter": "item",
          "values": ["10"]
        }
      },
      {
        "code": "sexo",
        "selection": {
          "filter": "item",
          "values": ["10"]
        }
      },
      {
        "code": "periodo",
        "selection": {
          "filter": "item",
          "values": [
            "20010101", "20020101", ..., "20240101"
          ]
        }
      }
    ],
    "response": {
      "format": "json-stat"
    }
  }
}</code></pre>

  <h2>3. Gr√°fico din√°mico</h2>
   <p>
     A continuaci√≥n, deberemos especificar el t√≠tulo del gr√°fico, el nombre de los ejes y las unidades. El formato del c√≥digo necesario puede verse en la siguiente p√°gina: 
     <a href="https://www.highcharts.com/demo/highcharts/line-chart" target="_blank">https://www.highcharts.com/demo/highcharts/line-chart</a> 
     (haz clic en el bot√≥n <strong>Code</strong>). Utilizando <em>JavaScript</em> y Highcharts, hemos creado un gr√°fico din√°mico simple. 
     Los datos pueden actualizarse en todo momento gracias a la consulta <em>JSON</em> realizada mediante <em>POST</em> a la API de Eustat.
   </p>

  <div id="container" style="width: 100%; height: 500px;"></div>

  <p class="nota">
    üí° Nota: haz clic con el bot√≥n derecho del rat√≥n y selecciona <em>"Ver c√≥digo fuente de la p√°gina"</em> para obtener el c√≥digo HTML completo del gr√°fico y su integraci√≥n con la API.
  </p>

  <script>
    const url = "https://www.eustat.eus/bankupx/api/v1/es/DB/PX_010154_cepv1_ep06b.px";
    const query = {
      "query": [
        {
          "code": "√°mbitos territoriales",
          "selection": {
            "filter": "item",
            "values": ["00001", "01", "48", "20"]
          }
        },
        {
          "code": "grandes grupos de edad cumplida",
          "selection": {
            "filter": "item",
            "values": ["10"]
          }
        },
        {
          "code": "sexo",
          "selection": {
            "filter": "item",
            "values": ["10"]
          }
        },
        {
          "code": "periodo",
          "selection": {
            "filter": "item",
            "values": [
              "20010101", "20020101", "20030101", "20040101",
              "20050101", "20060101", "20070101", "20080101",
              "20090101", "20100101", "20110101", "20120101",
              "20130101", "20140101", "20150101", "20160101",
              "20170101", "20180101", "20190101", "20200101",
              "20210101", "20220101", "20230101", "20240101"
            ]
          }
        }
      ],
      "response": {
        "format": "json-stat"
      }
    };

    $.post(url, JSON.stringify(query), function (obj) {
      const ds = JSONstat(obj).Dataset(0);
      const tiempo = ds.Dimension({ role: "time" })[0];
      const etiquetas = tiempo.id.map(id => tiempo.Category(id).label);

      const territorios = {
        "00001": "C.A. de Euskadi",
        "01": "Araba/√Ålava",
        "48": "Bizkaia",
        "20": "Gipuzkoa"
      };

      const series = Object.keys(territorios).map(cod => ({
        name: territorios[cod],
        data: ds.Data({ "√°mbitos territoriales": cod }, false)
      }));

      Highcharts.chart('container', {
        chart: { type: 'line' },
        title: {
          text: 'Evoluci√≥n de la poblaci√≥n de la C.A. de Euskadi y sus territorios hist√≥ricos (1 de enero, 2001‚Äì2024)'
        },
        xAxis: {
          categories: etiquetas,
          title: { text: 'Fecha' },
          tickInterval: 1
        },
        yAxis: {
          title: { text: 'Poblaci√≥n' }
        },
        tooltip: {
          valueSuffix: ' hab.'
        },
        series: series
      });
    });
  </script>

</body>
</html>
